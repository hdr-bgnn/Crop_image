# Crop_image
Small repository to store the "copping"step of the BGNN Fish project.

This repo is linked to main BGNN Fish project rpo [BGNN_Snakemake](https://github.com/hdr-bgnn/BGNN_Snakemake) that encompasses a complete analysis workflow. It contained the code for the "Cropping" part [see here](https://github.com/hdr-bgnn/BGNN_Snakemake/blob/main/Picture_for_Documentation/Workflow_stage_1.png). It is easier to understand the purpose this code and its application if you are familar with BGNN_Snakemake repo.

## 1 - Short description

  + We use raw fish image [available at Tulane](http://www.tubri.org/HDR/INHS/) and Metadata json file generated by [Drexel_metadata generator] (https://github.com/hdr-bgnn/drexel_metadata) to crop the fish out of a more complexe image.
  + The metadata json file contained the bounding box of the fish which use to crop the fish [here is an exmaple](https://github.com/hdr-bgnn/Crop_image/blob/main/Test_data/INHS_FISH_000742_cropped.jpg). We increase the size of the bounding box around the fish by 5% increase (by default, parameter) in case the bounding box (from the metadata) would truncate the edge of the fish. The Cropped image will be used later by a segmentation algorithm such as [trait_segmenation](https://github.com/hdr-bgnn/BGNN-trait-segmentation)

**input**
![original fish image](https://github.com/hdr-bgnn/Crop_image/blob/main/Test_data/INHS_FISH_000742.jpg)

**Cropped output**
![Cropped fish image](https://github.com/hdr-bgnn/Crop_image/blob/main/Test_data/INHS_FISH_000742_cropped.jpg)

## 2 - Usage

Input example : 
  + fish image .jpg [see INHS_FISH_000742.jpg](https://github.com/hdr-bgnn/Crop_image/blob/main/Test_data/INHS_FISH_000742.jpg)
  + Metadata.json [see INHS_FISH_000742.json](Test_data/INHS_FISH_000742.json)
  
Ouput :
  + Cropped image .jpg [see INHS_FISH_000742_cropped.jpg](https://github.com/hdr-bgnn/Crop_image/blob/main/Test_data/INHS_FISH_000742_cropped.jpg)

Usage in python
you need the environment define by crop_env.yml. I suggest to use anaconda or miniconda as environment manager

```
Crop_image_main.py [-h] [--increase] input_image imput_metadata output
```

Example using the Test_data with 5% increase in size

```
Crop_image_main.py INHS_FISH_000742.jpg INHS_FISH_000742.json INHS_FISH_000742_cropped.jpg --increase 0.05
```

The `increase` parameter defines the percentage increase of the bounding box from the original metadata size in percentage for each direction (5% increase in width and 5% in height as 0.05)

## 3 - Container and test

The container can be download here:

```
docker pull ghcr.io/hdr-bgnn/crop_image:latest
#or 
singualarity docker://ghcr.io/hdr-bgnn/crop_image:latest
```

Container Usage: 

In this section the name of the container "crop_image_0.0.2.sif" will depend on the version you are downloading or the name you give to container .sif 

The usage can be display like this: 

```
singularity run crop_image_0.0.2.sif
```

To execute the code on the [test data](https://github.com/hdr-bgnn/Crop_image/blob/main/Test_data/), run the following

```
singularity exec crop_image_0.0.2.sif Crop_image_main.py Test_data/INHS_FISH_000742.jpg Test_data/INHS_FISH_000742.json Test_data/INHS_FISH_000742_cropped_test.jpg
```

